var ToolsetDynamicSources=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=12)}([function(e,t){e.exports=window.wp.hooks},function(e,t){e.exports=window.wp.data},function(e,t){e.exports=lodash},function(e,t){e.exports=window.wp.element},function(e,t){e.exports=window.wp.i18n},function(e,t){e.exports=window.wp.compose},function(e,t){e.exports=window.wp.components},function(e,t){e.exports=window.toolsetCommonEs.block.control},function(e,t){e.exports=window.wp.apiFetch},function(e,t){e.exports=window.wp.url},function(e,t,r){},function(e,t,r){},function(e,t,r){"use strict";r.r(t);var n=r(1),o=r(0),c=r(4),i=r(8),a=r.n(i),u=r(2);function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,c=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,c=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw c}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function l(e,t,r,n,o,c,i){try{var a=e[c](i),u=a.value}catch(e){return void r(e)}a.done?t(u):Promise.resolve(u).then(n,o)}function p(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var c=e.apply(t,r);function i(e){l(c,n,o,i,a,"next",e)}function a(e){l(c,n,o,i,a,"throw",e)}i(void 0)})}}var f=window.toolsetDynamicSourcesScriptData,d=function(e,t,r,n){var o=f.cacheForViews&&f.cacheForViews[t]?f.cacheForViews[t]:f.cache,c="";return void 0!==o[r]&&(c=o[r]),void 0!==o[e]&&void 0!==o[e][r]&&t===o[e]["post-id"]&&(c=o[e][r]),void 0!==c[n]&&(c=c[n]),""!==c?{sourceContent:c}:null},b=function(){var e=p(regeneratorRuntime.mark(function e(t,r,o){var i,u,s,l,p,f=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=f.length>3&&void 0!==f[3]?f[3]:null,!(u=d(t,r,o,i))){e.next=4;break}return e.abrupt("return",u);case 4:return s="/toolset-dynamic-sources/v1/render-source/?source=".concat(o,"&provider=").concat(t,"&post=").concat(r),l="",i&&(l+="field=".concat(i)),""!==l&&(s+="&".concat(l)),e.prev=8,e.next=11,a()({path:s});case 11:return e.abrupt("return",e.sent);case 14:return e.prev=14,e.t0=e.catch(8),p=Object(c.sprintf)(Object(c.__)('Something went wrong while fetching the dynamic content from the selected source, with message: "%s".',"wpv-views"),e.t0.message),Object(n.dispatch)("core/notices").createErrorNotice(p,{id:"toolset_blocks_dynamic_source_content_preloading_error"}),e.abrupt("return",null);case 19:case"end":return e.stop()}},e,null,[[8,14]])}));return function(t,r,n){return e.apply(this,arguments)}}(),y=function(){var e=p(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a()({path:"/toolset-dynamic-sources/v1/get-cache?post=".concat(t)});case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),r=Object(c.sprintf)(Object(c.__)('Something went wrong while trying to update the sources cache, with message: "%s". Please reload the page and try again.',"wpv-views"),e.t0.message),Object(n.dispatch)("core/notices").createErrorNotice(r,{id:"toolset_blocks_cache_update_error"}),e.abrupt("return",null);case 11:case"end":return e.stop()}},e,null,[[0,6]])}));return function(t){return e.apply(this,arguments)}}(),m=function(e){return new Promise(function(t){a()({path:"/toolset-dynamic-sources/v1/search-post?s=".concat(e)}).then(function(e){var r=e.map(function(e){return{label:e.title,value:"custom_post_type|".concat(e.post_type,"|").concat(e.id)}});t(r)})})},h=function(){var e=p(regeneratorRuntime.mark(function e(t){var r,n,c,i,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.value.split("|"),n=s(r,3),c=n[1],i=n[2],e.next=3,a()({path:"toolset-dynamic-sources/v1/get-source?post_type=".concat(c,"&post_id=").concat(i)});case 3:l=e.sent,d=t.value,f.postProviders.find(function(e){return e.value===d})||f.postProviders.push({value:d,label:t.label}),f.dynamicSources[d]=l.__current_post,y(i).then(function(e){f.cache[d]=e.__current_post,Object(o.doAction)("tb.caching.updated")}),Object(o.addAction)("tb.caching.tick","toolset-blocks",function(){var e=p(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(i);case 2:r=e.sent,t[d]&&Object(u.isEqual)(t[d],r.__current_post)||(f.cache[d]=r.__current_post,Object(o.doAction)("tb.caching.updated"));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();function v(e,t,r,n,o,c,i){try{var a=e[c](i),u=a.value}catch(e){return void r(e)}a.done?t(u):Promise.resolve(u).then(n,o)}var g=window.toolsetDynamicSourcesScriptData,w=function(){var e,t=(e=regeneratorRuntime.mark(function e(){var t,r,c,i,a,u,s,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Object(n.select)("core/editor"),r=JSON.stringify(t.getBlocks()),c=!!r.includes("dynamic"),i=!!r.includes("toolset-blocks/field"),a=!!r.includes("toolset-blocks/repeating-field"),u=!!r.includes("toolset-blocks/fields-and-text"),(c||u||i||a)&&!Object(n.select)(g.dynamicSourcesStore).getCacheUpdating()){e.next=8;break}return e.abrupt("return");case 8:return s=Object(n.select)(g.dynamicSourcesStore).getPreviewPost()||t.getCurrentPostId(),Object(n.dispatch)(g.dynamicSourcesStore).setCacheUpdating(!0),e.next=12,y(s);case 12:l=e.sent,Object(n.dispatch)(g.dynamicSourcesStore).setCacheUpdating(!1),Object(o.doAction)("tb.dynamicSources.actions.cache.tick",l);case 15:case"end":return e.stop()}},e)}),function(){var t=this,r=arguments;return new Promise(function(n,o){var c=e.apply(t,r);function i(e){v(c,n,o,i,a,"next",e)}function a(e){v(c,n,o,i,a,"throw",e)}i(void 0)})});return function(){return t.apply(this,arguments)}}(),O=function(){Object(o.addAction)("tb.dynamicSources.actions.cache.tick","toolset-blocks",function(e){var t=!1;e&&!Object(u.isEqual)(e,g.cache)&&(g.cache=Object.assign({},g.cache,e),t=!0),g.cacheForViews&&(t=!0),t&&Object(o.doAction)("tb.dynamicSources.actions.cache.updated")}),Object(o.addAction)("tb.dynamicSources.actions.cache.initiateFetching","toolset-blocks",function(){w()}),window.setInterval(function(){Object(o.doAction)("tb.dynamicSources.actions.cache.initiateFetching")},3e4)};function S(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,(r=[{key:"get",value:function(e,t){if(e&&t)return a()({path:"/toolset-dynamic-sources/v1/dynamic-sources?post-type=".concat(e.join(","),"&preview-post-id=").concat(t)})}}])&&S(t.prototype,r),n&&S(t,n),e}();function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(r,!0).forEach(function(t){C(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function C(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var E=window.toolsetDynamicSourcesScriptData,k={dynamicSources:[]},D={setLoading:function(e,t){return{type:"SET_LOADING",blockID:e,loading:t}},setCacheUpdating:function(e){return{type:"SET_CACHE_UPDATING",cacheUpdating:e}},setPreviewPost:function(e){return{type:"SET_PREVIEW_POST",previewPost:e}},setDynamicSources:function(e){return{type:"DYNAMIC_SOURCES_SET",dynamicSources:e}},getDynamicSources:function(e,t,r){return{type:"DYNAMIC_SOURCES_GET",postTypes:e,previewPostID:t}}},R=new j,F={DYNAMIC_SOURCES_GET:function(e){return R.get(e.postTypes,e.previewPostID)}},A={getDynamicSources:regeneratorRuntime.mark(function e(t,r,n){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.getDynamicSources(t,r,n);case 2:return o=e.sent,e.next=5,D.setDynamicSources(o);case 5:case"end":return e.stop()}},e)})},I={actions:D,selectors:{getLoading:function(e,t){return!!e[t]&&e[t].loading},getCacheUpdating:function(e){return!!e.cacheUpdating&&e.cacheUpdating},getPreviewPost:function(e){return e.previewPost?e.previewPost:null},getDynamicSources:function(e,t,r,n){return e.dynamicSources}},controls:F,resolvers:A,reducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_LOADING":return _({},e,C({},t.blockID,{loading:t.loading}));case"SET_CACHE_UPDATING":return _({},e,{cacheUpdating:!!t.cacheUpdating});case"SET_PREVIEW_POST":return _({},e,{previewPost:parseInt(t.previewPost)});case"DYNAMIC_SOURCES_SET":return _({},e,{dynamicSources:t.dynamicSources})}return e}},T=function(){Object(n.registerStore)(E.dynamicSourcesStore,I)},x=r(3),U=r(6),V=r(5),L=r(9),N=r(7);r(10);function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(r,!0).forEach(function(t){Q(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function K(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function W(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Y=window.toolsetDynamicSourcesScriptData,J=function(e){function t(e){var r,n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,o=G(t).call(this,e),r=!o||"object"!==q(o)&&"function"!=typeof o?W(n):o,Q(W(r),"updateBlockContentFromCache",function(){r.setState({postUrl:Y.cache.__current_post["post-url"],postId:Y.cache.__current_post["post-id"]})}),Q(W(r),"maybeRenderUpdatingCacheSpinner",function(){var e=null;return r.props.isCacheUpdating&&(e=React.createElement("div",{className:"spinner-control"},React.createElement(U.Spinner,null))),e}),Q(W(r),"makePreviewUrl",function(){var e=r.state.postUrl;return r.state.postId!==r.state.selectedPost.value&&(e=r.state.selectedPost.guid),Object(L.addQueryArgs)(e,{"content-template-id":r.props.currentPostId})}),Q(W(r),"maybeRenderPreviewLink",function(){return React.createElement("span",{className:"editor-post-view"},React.createElement("a",{target:"wp-preview-"+r.props.currentPostId,rel:"noopener noreferrer",href:r.makePreviewUrl()},Object(c.__)("View on front-end","wpv-views")),!!r.props.hasChangedContent&&React.createElement("small",null,Object(c.__)("(Click Update button first to view the recent changes)","wpv-views")))}),r.state={selectedPost:Object(u.find)(Y.previewPosts,["value",parseInt(r.props.previewPost)]),postUrl:Y.cache.__current_post["post-url"],postId:Y.cache.__current_post["post-id"]},r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(t,x["Component"]),r=t,(n=[{key:"componentDidMount",value:function(){Object(o.addAction)("tb.dynamicSources.actions.cache.updated","toolset-blocks",this.updateBlockContentFromCache)}},{key:"render",value:function(){var e=this;if(!Y.previewPosts||Y.previewPosts.length<1)return null;var t=Object(u.maxBy)(Y.previewPosts,function(e){return e.label.length}),r=Y.previewPosts&&Y.previewPosts.length>0?5*t.label.length+120:0,n={container:function(e){return M({},e,{width:"180px"})},menu:function(e){return M({},e,{width:"".concat(r,"px")})}};return React.createElement(x.Fragment,null,React.createElement("label",{htmlFor:"post-selector-".concat(this.props.instanceId)},Object(c.__)("View with","wpv-views"),": "),React.createElement(N.Select,{id:"post-selector-".concat(this.props.instanceId),value:this.state.selectedPost,options:Y.previewPosts,onChange:function(t){e.setState({selectedPost:t}),e.props.setPreviewPost(t.value),e.props.editPost({meta:{tb_preview_post:t.value}})},className:"toolset-blocks-post-selector-control",styles:n}),this.maybeRenderPreviewLink(),this.maybeRenderUpdatingCacheSpinner())}}])&&K(r.prototype,n),i&&K(r,i),t}(),$=Object(V.compose)([Object(n.withSelect)(function(e){var t=e(Y.dynamicSourcesStore),r=t.getPreviewPost,n=t.getCacheUpdating,o=e("core/editor"),c=o.getCurrentPostId,i=o.hasChangedContent;return{previewPost:r(),isCacheUpdating:n(),currentPostId:c(),hasChangedContent:i()}}),Object(n.withDispatch)(function(e){var t=e("core/editor").editPost;return{setPreviewPost:e(Y.dynamicSourcesStore).setPreviewPost,editPost:t}}),V.withInstanceId])(J);function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function X(e){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e,t){return(ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function te(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var re=window.toolsetDynamicSourcesScriptData,ne=function(e){function t(){var e,r,o,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=X(t).call(this,c),e=!o||"object"!==z(o)&&"function"!=typeof o?Z(r):o,te(Z(e),"PLACEHOLDER_ID","toolset-blocks-post-selector"),te(Z(e),"deferAddingPostSelector",function(t){var r=Object(n.select)("core/editor").getCurrentPostType;if(0!==jQuery("body").length){var o=jQuery("#editor.block-editor__container");if(0!==o.length)0!==o.find(".edit-post-header-toolbar").length?Object(u.isEqual)("view-template",r())&&e.addPostSelector():setTimeout(Object(u.partial)(t,t),1)}else setTimeout(Object(u.partial)(t,t),1)}),te(Z(e),"addPostSelector",function(){var t=jQuery("#editor.block-editor__container .edit-post-header-toolbar");0!==t.length&&(t.append('<div id="'.concat(e.PLACEHOLDER_ID,'"></div>')),Object(x.render)(React.createElement($,null),document.querySelector("#"+e.PLACEHOLDER_ID)))}),!Object(n.select)(re.dynamicSourcesStore).getPreviewPost()){var i=Object(u.find)(re.previewPosts,["value",parseInt(re.postPreview)]);i&&Object(u.has)(i,"value")&&Object(n.dispatch)(re.dynamicSourcesStore).setPreviewPost(Object(u.get)(i,"value"))}return e.deferAddingPostSelector(e.deferAddingPostSelector),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ee(e,t)}(t,x["Component"]),t}();function oe(e){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ce(r,!0).forEach(function(t){pe(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ce(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ae(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ue(e){return(ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function se(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function le(e,t){return(le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var fe=window,de=fe.toolsetDynamicSourcesScriptData,be=fe.Toolset,ye=function(e){function t(){var e,r,c,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,c=ue(t).call(this,i),e=!c||"object"!==oe(c)&&"function"!=typeof c?se(r):c,pe(se(e),"postTypes",[]),pe(se(e),"previewPostId",null),pe(se(e),"viewStoreIds",[]),pe(se(e),"random",null),pe(se(e),"blockInsideViewAdjustmentCallback",function(t,r,o){var c=e.maybeGetParentViewBlock(r);if(c){var i=Object(n.select)(c.attributes.reduxStoreId).getGeneral().preview_post_id;if(de["".concat(o,"ForViews")]&&de["".concat(o,"ForViews")][i])return de["".concat(o,"ForViews")][i]}return t}),pe(se(e),"maybeGetParentViewBlock",function(e){var t=Object(n.select)("core/editor"),r=t.getBlock,o=t.getBlockRootClientId,c=null,i=e;do{if(i=o(i)){var a=r(i);"toolset-views/view-editor"===a.name&&(c=a)}}while(i);return c}),Object(o.addAction)("tb.dynamicSources.actions.cache.initiateFetching","toolset-blocks",function(){Object(n.select)("core/editor").getBlocks().filter(function(e){return"toolset-views/view-editor"===e.name}).forEach(function(e){var t=e.attributes.reduxStoreId,r=Object(n.select)(t).getGeneral(),c=Object(n.select)(t).getContentSelection();"posts"===c.query_type&&Object(o.doAction)("tb.dynamicSources.action.updateSources",c.post_type,r.preview_post_id,t)})}),Object(o.addFilter)("tb.dynamicSources.filters.adjustPreviewPostID","toolset-blocks",function(t,r){var o=e.maybeGetParentViewBlock(r);return o?Object(n.select)(o.attributes.reduxStoreId).getGeneral().preview_post_id:t}),Object(o.addFilter)("tb.dynamicSources.filters.adjustSourcesForBlocksInsideViews","toolset-blocks",function(t,r){return e.blockInsideViewAdjustmentCallback(t,r,"dynamicSources")}),Object(o.addFilter)("tb.dynamicSources.filters.adjustProvidersForBlocksInsideViews","toolset-blocks",function(t,r){return e.blockInsideViewAdjustmentCallback(t,r,"postProviders")}),Object(o.addAction)("tb.dynamicSources.action.updateSources","toolset-blocks",function(t,r,o){e.postTypes=t,e.random=Math.random(),e.previewPostId=r,e.viewStoreIds[r]&&!e.viewStoreIds[r].includes(o)?e.viewStoreIds[r]=[].concat(ae(e.viewStoreIds[r]),[o]):e.viewStoreIds[r]=[o],Object(n.select)(de.dynamicSourcesStore).getDynamicSources(e.postTypes,e.previewPostId,e.random)}),be.hooks.addFilter("wpv-filter-wpv-shortcodes-gui-post-id-for-dialog-create",function(t){return e.previewPostId||t}),Object(n.subscribe)(function(){if(!(e.postTypes.length<=0)){var t=Object(n.select)(de.dynamicSourcesStore).getDynamicSources(e.postTypes,e.previewPostId,e.random);if(t&&t.previewPostId){var r={},c={},i={};c[t.previewPostId]=t.postProviders,r[t.previewPostId]=t.dynamicSources,i[t.previewPostId]=t.cache,de.postProvidersForViews=ie({},de.postProvidersForViews,{},c),de.dynamicSourcesForViews=ie({},de.dynamicSourcesForViews,{},r);var a=ie({},de.cacheForViews,{},i);JSON.stringify(a)!==JSON.stringify(de.cacheForViews)&&(Object(o.doAction)("tb.dynamicSources.actions.cache.tick"),de.cacheForViews=a,e.viewStoreIds[t.previewPostId].forEach(function(e){Object(o.doAction)("toolset.views.updatePreview",e)}))}}}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&le(e,t)}(t,x["Component"]),t}(),me=function(e){switch(e.constructor){case Array:return e.length?e[0]:"";case Object:var t=Object.keys(e);return t.length?e[t[0]]:"";default:return e.toString()}};function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ve(e){return(ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ge(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function we(e,t){return(we=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Oe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Se=window.toolsetDynamicSourcesScriptData,je=function(e){function t(){var e,r,c,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,u=new Array(a),s=0;s<a;s++)u[s]=arguments[s];return c=this,i=(e=ve(t)).call.apply(e,[this].concat(u)),r=!i||"object"!==he(i)&&"function"!=typeof i?ge(c):i,Oe(ge(r),"componentDidUpdate",function(e){r.props.previewPost!==e.previewPost&&(Object(n.select)(Se.dynamicSourcesStore).getCacheUpdating()||Object(o.doAction)("tb.dynamicSources.actions.cache.initiateFetching"))}),Oe(ge(r),"render",function(){return null}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&we(e,t)}(t,x["Component"]),t}(),Pe=Object(V.compose)([Object(n.withSelect)(function(e){return{previewPost:(0,e(Se.dynamicSourcesStore).getPreviewPost)()}})])(je);function _e(e){return(_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(){return(Ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Ee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ke(e,t){return!t||"object"!==_e(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function De(e){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Re(e,t){return(Re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fe=Object(V.createHigherOrderComponent)(function(e){var t=function(t){function r(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),ke(this,De(r).apply(this,arguments))}var n,o,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Re(e,t)}(r,x["Component"]),n=r,(o=[{key:"render",value:function(){return React.createElement(x.Fragment,null,React.createElement(Pe,Ce({},this.props.ownProps,this.mergeProps)),React.createElement(e,Ce({},this.props.ownProps,this.mergeProps)))}}])&&Ee(n.prototype,o),c&&Ee(n,c),r}();return function(e){return React.createElement(t,{ownProps:e})}},"withPostPreview");function Ae(e){return(Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Te(e,t){return!t||"object"!==Ae(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xe(e){return(xe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ue(e,t){return(Ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ve="tb-dynamic-container",Le=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Te(this,xe(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ue(e,t)}(t,x["Component"]),r=t,(n=[{key:"filterUnusedDynamics",value:function(e){Array.isArray(e)||(e=[e]);var t=[];return e.map(function(e){e.source&&e.provider&&t.push(e)}),t}},{key:"getShortcodeStart",value:function(e){if(0===e.length)return"";var t="[".concat(Ve),r=[],n=[],o=[];return e.map(function(e){e.customPost?r.push(e.customPost.value):r.push(e.provider),n.push(e.source),o.push(e.field?e.field:"")}),t+=" provider='".concat(r.join("#+*#"),"'"),t+=" source='".concat(n.join("#+*#"),"'"),t+=" field='".concat(o.join("#+*#"),"'"),t+="]"}},{key:"getShortcodeEnd",value:function(e){return 0===e.length?"":"[/".concat(Ve,"]")}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.requiredDynamics,n=this.filterUnusedDynamics(r);return React.createElement(x.Fragment,null,this.getShortcodeStart(n),t,this.getShortcodeEnd(n))}}])&&Ie(r.prototype,n),o&&Ie(r,o),t}();r(11);function Ne(e){return(Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Be(e,t){return!t||"object"!==Ne(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ke(e,t){return(Ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ge=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Be(this,Me(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ke(e,t)}(t,x["Component"]),r=t,(n=[{key:"render",value:function(){return React.createElement(x.Fragment,null,Object(c.__)("This content is coming from a Dynamic Source. Use the Settings Sidebar to change its source.","wpv-views"))}}])&&qe(r.prototype,n),o&&qe(r,o),t}();function We(e){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function He(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Qe(e){return(Qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ye(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Je(e,t){return(Je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ze=window.toolsetDynamicSourcesScriptData,Xe=function(e){function t(){var e,r,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,a=new Array(i),u=0;u<i;u++)a[u]=arguments[u];return n=this,o=(e=Qe(t)).call.apply(e,[this].concat(a)),r=!o||"object"!==We(o)&&"function"!=typeof o?Ye(n):o,$e(Ye(r),"maybeRenderLoadingSpinner",function(){var e=null;return r.props.loading&&(e=React.createElement(U.Spinner,{key:"tb-spinner"})),e}),$e(Ye(r),"renderOverlayWithSpiner",function(){return React.createElement("div",{className:"tb-overlay wp-block-embed is-loading",key:"tb-overlay"},React.createElement(U.Spinner,null))}),$e(Ye(r),"renderEditWrapperContent",function(){var e=[r.props.children];return r.props.loading&&e.push(r.renderOverlayWithSpiner()),React.createElement(x.Fragment,null,e)}),$e(Ye(r),"renderDynamicContentBreadcrumb",function(){var e=r.props,t=e.isSelected,n=e.hasDynamicSource;if(t&&n)return React.createElement("div",{className:"editor-block-list__breadcrumb block-editor-block-list__breadcrumb"},React.createElement(U.Toolbar,null,React.createElement(x.Fragment,null,r.maybeRenderLoadingSpinner(),React.createElement("span",{className:"breadcrumb-label"},Object(c.__)("Dynamic Content","wpv-views")))))}),$e(Ye(r),"renderEditWrapper",function(){var e=r.props.hasDynamicSource,t="wp-block-toolset-blocks-wrapper";return React.createElement("div",{className:e?"".concat(t," dynamic"):t},r.renderEditWrapperContent())}),r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Je(e,t)}(t,x["Component"]),r=t,(n=[{key:"render",value:function(){var e=this.props,t=e.hasDynamicSource,r=e.disableTooltip,n=void 0!==r&&r,o=this.renderEditWrapper();return t&&!n&&(o=React.createElement(N.Tooltip,{text:React.createElement(Ge,null),trigger:"mouseenter focus click",maxWidth:"500"},o)),o}}])&&He(r.prototype,n),o&&He(r,o),t}(),Ze=Object(V.compose)([Object(n.withSelect)(function(e,t){return{loading:(0,e(ze.dynamicSourcesStore).getLoading)(t.clientId)}})])(Xe);function et(e){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function rt(e,t){return!t||"object"!==et(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function nt(e){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ct=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),rt(this,nt(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(t,x["Component"]),r=t,(n=[{key:"render",value:function(){var e=this.props,t=e.hasDynamicSource,r=e.children;if(!t)return null;var n=React.createElement("div",{className:"tb-field__overlay"});return r&&(n=React.createElement("div",{className:"tb-field__overlay"},r)),React.createElement(N.Tooltip,{text:React.createElement(Ge,null),trigger:"mouseenter focus click",maxWidth:"500"},n)}}])&&tt(r.prototype,n),o&&tt(r,o),t}();function it(e){return(it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function at(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,c=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,c=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw c}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ut(e,t,r,n,o,c,i){try{var a=e[c](i),u=a.value}catch(e){return void r(e)}a.done?t(u):Promise.resolve(u).then(n,o)}function st(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var c=e.apply(t,r);function i(e){ut(c,n,o,i,a,"next",e)}function a(e){ut(c,n,o,i,a,"throw",e)}i(void 0)})}}function lt(){return(lt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function pt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ft(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pt(r,!0).forEach(function(t){ht(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pt(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function dt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function bt(e){return(bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ht(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var vt=window.toolsetDynamicSourcesScriptData,gt=function(e){function t(e){var r,n,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,i=bt(t).call(this,e),r=!i||"object"!==it(i)&&"function"!=typeof i?yt(n):i,ht(yt(r),"DEFAULT_POST_PROVIDER",null),ht(yt(r),"ungroupedSources",[]),ht(yt(r),"componentDidUpdate",function(e){if(r.props.previewPost!==e.previewPost&&r.ungroupedSources.length&&r.props.dynamicSourcesEligibleAttribute.sourceObject){var t=Object(u.find)(r.ungroupedSources,{value:r.props.dynamicSourcesEligibleAttribute.sourceObject}),n=t.fields.length>0?Object(u.find)(t.fields,{value:r.props.dynamicSourcesEligibleAttribute.fieldObject}):null;r.dynamicSourceSelectChanged(t),r.dynamicSourceFieldSelectChanged(n)}}),ht(yt(r),"customStyles",{menu:function(e){return ft({},e,{position:"relative"})},input:function(e,t){return ft({},e,{"& input:focus":{boxShadow:(t.isFocused,"none !important")}})}}),ht(yt(r),"filterSources",function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.postType,c=e.clientId,i=e.componentId,a="__custom_post"===t.postProviderObject&&t.customPostObject?t.customPostObject.value:t.postProviderObject||r.DEFAULT_POST_PROVIDER,s=Object(o.applyFilters)("tb.dynamicSources.filters.adjustSourcesForBlocksInsideViews",vt.dynamicSources,c),l=i?Object(o.applyFilters)("tb.dynamicSources.filters.adjustSourcesForBlocks",s,i):s,p=Object(u.cloneDeep)(l[a]);return p.forEach(function(e){e.options=e.options.filter(function(e){var c=function(e,t){if(!t)return!0;var r=Array.isArray(t)?t:[t];return!e.filter(function(e){return r.includes(e)}).length},i=Object(o.applyFilters)("toolsetViews.filters.getParentViewBlock",null,r.props.clientId),a=Object(o.applyFilters)("toolsetViews.filters.getViewEditorBlockTypes",null);if("post-content"===e.value&&"view-template"!==n&&!Object(u.isUndefined)(a.BLOCK_ID_EDITOR)&&a.BLOCK_ID_EDITOR!==Object(u.get)(i,"name",null))return!1;if(r.ungroupedSources.push(e),Object(u.has)(e,"fields")&&!Object(u.isEmpty)(e.fields)){var s=Object(u.find)(e.fields,function(e){return!!c(e.categories,t.bannedCategories)&&Object(u.includes)(e.categories,t.category)});return!Object(u.isEmpty)(s)}return!!c(e.categories,t.bannedCategories)&&Object(u.includes)(e.categories,t.category)})}),p}),ht(yt(r),"renderDynamicPostProviderSelect",function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.clientId,i=e.hideLabels;t.postProviderObject||t.selectPostProviderChangedCallback(r.DEFAULT_POST_PROVIDER);var a=Object(o.applyFilters)("tb.dynamicSources.filters.adjustProvidersForBlocksInsideViews",vt.postProviders,n),s=Object(u.find)(a,{value:t.postProviderObject}),l=i?{placeholder:Object(c.__)("Select a Post Source","wpv-views")}:{};return React.createElement(x.Fragment,{key:"post-provider-select"},React.createElement(U.BaseControl,{label:!i&&Object(c.__)("Post Source","wpv-views")},React.createElement(N.Select,lt({options:a,styles:r.customStyles},l,{value:s,onChange:function(e){t.selectPostProviderChangedCallback(e.value),t.selectCustomPostChangedCallback(null),t.selectSourceChangedCallback(null),t.selectFieldChangedCallback(null),t.sourceContentFetchedCallback("")}}))))}),ht(yt(r),"dynamicSourceSelectChanged",function(){var e=st(regeneratorRuntime.mark(function e(t){var n,c,i,a,u,s,l,p,f,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(o.doAction)("tb.dynamicSources.actions.source.changed",t),n=r.props.dynamicSourcesEligibleAttribute,c=null!==t?t.value:null,n.selectSourceChangedCallback(c),n.selectFieldChangedCallback(null),!t||0!==t.fields.length){e.next=15;break}return i=r.props,a=i.clientId,u=i.setLoading,s=i.post,l=i.previewPost,p=n.postProviderObject||r.DEFAULT_POST_PROVIDER,u(a,!0),f=Object(o.applyFilters)("tb.dynamicSources.filters.adjustPreviewPostID",l||s,a),e.next=12,r.fetchDynamicContent(p,f,c);case 12:null===(d=e.sent)?n.sourceContentFetchedCallback(""):n.sourceContentFetchedCallback(d),u(a,!1);case 15:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),ht(yt(r),"renderDynamicSourceSelect",function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.hideLabels,o=r.filterSources(),i=Object(u.find)(r.ungroupedSources,{value:t.sourceObject})||null;if("__custom_post"===t.postProviderObject&&!t.customPostObject)return null;var a=n?{placeholder:Object(c.__)("Select a Source","wpv-views")}:{};return React.createElement(x.Fragment,{key:"dynamic-source-select"},React.createElement(U.BaseControl,{label:!n&&Object(c.__)("Source","wpv-views")},React.createElement(N.Select,lt({isClearable:!0,options:o,styles:r.customStyles},a,{value:i,onChange:r.dynamicSourceSelectChanged}))))}),ht(yt(r),"dynamicSourceFieldSelectChanged",function(){var e=st(regeneratorRuntime.mark(function e(t){var n,c,i,a,u,s,l,p,f,d,b;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(o.doAction)("tb.dynamicSources.actions.field.changed",t),n=r.props.dynamicSourcesEligibleAttribute,c=null!==t?t.value:null,n.selectFieldChangedCallback(c),!c){e.next=16;break}return i=r.props,a=i.clientId,u=i.setLoading,s=i.post,l=i.previewPost,u(a,!0),p=n.postProviderObject,f=n.sourceObject,n.sourceContentFetchedCallback(""),d=Object(o.applyFilters)("tb.dynamicSources.filters.adjustPreviewPostID",l||s,a),e.next=13,r.fetchDynamicContent(p,d,f,c);case 13:b=e.sent,n.sourceContentFetchedCallback(b),u(a,!1);case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),ht(yt(r),"renderDynamicSourceSearchPost",function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.hideLabels;if("__custom_post"!==t.postProviderObject)return null;var o=n?{placeholder:Object(c.__)("Select a Post Name","wpv-views")}:{};return React.createElement(x.Fragment,{key:"dynamic-custom-post-select"},React.createElement(U.BaseControl,{label:!n&&Object(c.__)("Post Name","wpv-views")},React.createElement(N.AsyncSelect,lt({cacheOptions:!0,loadOptions:m.bind(yt(r)),onChange:r.customPostSelectChanged,styles:r.customStyles},o,{value:t.customPostObject}))))}),ht(yt(r),"customPostSelectChanged",function(){var e=st(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.props.dynamicSourcesEligibleAttribute,e.next=3,r.loadSourceFromCustomPost(t);case 3:n.selectCustomPostChangedCallback(t),n.selectSourceChangedCallback(null),n.selectFieldChangedCallback(null),n.sourceContentFetchedCallback("");case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),ht(yt(r),"renderDynamicSourceFieldsSelect",function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.hideLabels;if(t.sourceObject){var o=Object(u.find)(r.ungroupedSources,["value",t.sourceObject]),i=o?o.fields:[];if(i=Object(u.filter)(i,function(e){return Object(u.includes)(e.categories,t.category)}),Object(u.isEmpty)(i))return;var a=1===Object.keys(i).length?i:null,s=["image","video","audio"].includes(t.category)?Object(u.find)(i,{value:t.fieldObject}):Object(u.find)(i,{value:t.fieldObject})||a;s&&s===a&&r.dynamicSourceFieldSelectChanged(s[0]);var l=n?{placeholder:Object(c.__)("Select a Field","wpv-views")}:{};return React.createElement(U.BaseControl,{label:!n&&Object(c.__)("Field","wpv-views"),key:"dynamic-source-fields-select"},React.createElement(N.Select,lt({isClearable:!0,options:i,styles:r.customStyles},l,{value:s,onChange:r.dynamicSourceFieldSelectChanged})))}}),ht(yt(r),"renderDynamicSourcesInfoMessages",function(){return Object.keys(r.state.infoMessageQueue).length<=0?null:Object.keys(r.state.infoMessageQueue).map(function(e){return React.createElement(U.Notice,{status:"info",key:e,isDismissible:!1},r.state.infoMessageQueue[e])})}),ht(yt(r),"renderDynamicSourceSelectControls",function(){if(r.props.dynamicSourcesEligibleAttribute.condition)return[r.renderDynamicPostProviderSelect(),r.renderDynamicSourceSearchPost(),r.renderDynamicSourceSelect(),r.renderDynamicSourceFieldsSelect()]}),ht(yt(r),"renderDynamicSourceToggleControl",function(){var e=r.props.dynamicSourcesEligibleAttribute;return e.toggleHide||!1?null:React.createElement(U.ToggleControl,{label:e.label,checked:e.condition,onChange:e.toggleChangedCallback})}),ht(yt(r),"renderDynamicSourceControls",function(){var e=r.props,t=e.clientId,n=e.dynamicSourcesEligibleAttribute,o=n.attributeKey?"-"+n.attributeKey:"";if(n)return React.createElement("div",{className:t+o},r.renderDynamicSourceToggleControl(),r.renderDynamicSourceSelectControls(),r.renderDynamicSourcesInfoMessages())}),r.DEFAULT_POST_PROVIDER=vt.postProviders[0].value,r.state={infoMessageQueue:{}},Object(o.addAction)("tb.dynamicSources.actions.field.changed","toolset-blocks",function(e){var t=r.state.infoMessageQueue;e&&"rfg"===e.type?t.rfg=React.createElement(x.Fragment,null,React.createElement("p",{dangerouslySetInnerHTML:{__html:Object(c.sprintf)(Object(c.__)("%1$s is a Repeating Field Group. If you want to display its fields here, put another View block into this Loop item and choose %1$s in the Content Selection step of the View wizard.","wpv-views"),"<strong>".concat(e.label,"</strong>"))}})):delete t.rfg,r.setState({infoMessageQueue:t})}),Object(o.addAction)("tb.dynamicSources.actions.dynamicSourceComponentDidMount","toolset-blocks",function(e){if(e===r.props.clientId){var t=r.props.dynamicSourcesEligibleAttribute,n=Object(u.find)(r.ungroupedSources,{value:t.sourceObject})||null;if(n){Object(o.doAction)("tb.dynamicSources.actions.source.changed",n);var c=n.fields.length>0?Object(u.find)(n.fields,{value:t.fieldObject}):null;c&&Object(o.doAction)("tb.dynamicSources.actions.field.changed",c)}}}),r}var r,n,i,a,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mt(e,t)}(t,x["Component"]),r=t,(n=[{key:"componentDidMount",value:function(){Object(o.doAction)("tb.dynamicSources.actions.dynamicSourceComponentDidMount",this.props.clientId)}},{key:"componentWillMount",value:(s=st(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.props.dynamicSourcesEligibleAttribute).customPostObject||vt.dynamicSources[t.customPostObject.value]){e.next=4;break}return e.next=4,this.loadSourceFromCustomPost(t.customPostObject);case 4:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"loadSourceFromCustomPost",value:(a=st(regeneratorRuntime.mark(function e(t){var r,n,o,c,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props,n=r.clientId,o=r.dynamicSourcesEligibleAttribute,(c=r.setLoading)(n,!0),e.next=4,h(t);case 4:i=t.value,o.postProviderObject=i,c(n,!1);case 7:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"isCustomPostProvider",value:function(e){return e.match(/^custom_post_type\|[^\|]+\|\d+$/)||"__custom_post"===e}},{key:"fetchDynamicContent",value:function(e,t,r,n){var o=this.props.dynamicSourcesEligibleAttribute;if(!o.customPostObject)return b(e,t,r,n);var c=this.isCustomPostProvider(e),i=at((c?o.customPostObject.value:"").split("|"),2)[1],a=c?i:t,u=c?o.customPostObject.value:e;return b(u,a,r,n)}},{key:"render",value:function(){return this.renderDynamicSourceControls()}}])&&dt(r.prototype,n),i&&dt(r,i),t}(),wt=Object(V.compose)([Object(n.withSelect)(function(e){var t=e("core/editor"),r=t.getCurrentPostId,n=t.getCurrentPostType,o=e(vt.dynamicSourcesStore).getPreviewPost;return{post:r(),postType:n(),previewPost:o()}}),Object(n.withDispatch)(function(e){var t=e("core/notices").createErrorNotice,r=e(vt.dynamicSourcesStore);return{createErrorNotice:t,setLoading:r.setLoading,setPreviewPost:r.setPreviewPost}})])(gt);function Ot(){return(Ot=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function St(e,t,r,n,o,c,i){try{var a=e[c](i),u=a.value}catch(e){return void r(e)}a.done?t(u):Promise.resolve(u).then(n,o)}function jt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Pt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?jt(r,!0).forEach(function(t){_t(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jt(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ct(e){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Et(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function kt(e){return(kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rt(e,t){return(Rt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ft={isActive:!1,provider:null,source:null,customPost:null,field:null},At=Object(V.createHigherOrderComponent)(function(e){return function(t){function r(){var e,t,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),t=this,(e=!(o=kt(r).apply(this,arguments))||"object"!==Ct(o)&&"function"!=typeof o?Dt(t):o).dynamicFieldsRegister=e.dynamicFieldsRegister.bind(Dt(e)),e.dynamicFieldControlRender=e.dynamicFieldControlRender.bind(Dt(e)),e.dynamicFieldGet=e.dynamicFieldGet.bind(Dt(e)),e.dynamicFieldReset=e.dynamicFieldReset.bind(Dt(e)),e.dynamicFieldNoDataRender=e.dynamicFieldNoDataRender.bind(Dt(e)),e.requestUpdateContent=e.requestUpdateContent.bind(Dt(e)),e.doUpdateContent=e.doUpdateContent.bind(Dt(e)),e.requestFieldToggle=e.requestFieldToggle.bind(Dt(e)),e.requestFieldAttributeUpdate=e.requestFieldAttributeUpdate.bind(Dt(e)),e.doFieldsAttributeUpdate=e.doFieldsAttributeUpdate.bind(Dt(e)),e.currentPostId=Object(n.select)("core/editor").getCurrentPostId(),e.updateContentDebounce=null,e.updateFieldsAttributesDebounce=null,e.attributesUpdateRequired=!1,e}var i,a,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rt(e,t)}(r,x["Component"]),i=r,(a=[{key:"componentDidMount",value:function(){this.requestUpdateContent(),Object(o.addAction)("tb.dynamicSources.actions.cache.updated","toolset-blocks",this.requestUpdateContent)}},{key:"dynamicFieldsRegister",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dynamic";"object"===Ct(e)?this.fields?Object.keys(this.fields).toString()!==Object.keys(e).toString()&&this.throwError("dynamicFieldsRegister() is called twice. Register all fields with one call."):(this.dynamicRootAttributeKey=r,this.fields={},Object.keys(e).forEach(function(n){e[n].attributeKey=e[n].attributeKey||n,t.fields[n]=Pt({},Ft,{},t.props.attributes[r]&&t.props.attributes[r][n]?t.props.attributes[r][n]:{},{},e[n])})):this.throwError("dynamicFieldsRegister() first parameter must be an object.")}},{key:"dynamicFieldControlRender",value:function(e){if(this.fieldExists(e))return React.createElement(wt,{clientId:this.props.clientId,dynamicSourcesEligibleAttribute:this.getFieldControlSetup(this.fields[e])})}},{key:"dynamicFieldGet",value:function(e){return this.fieldExists(e)?this.fields[e]:Ft}},{key:"dynamicFieldReset",value:function(e){this.fieldExists(e)&&(clearTimeout(this.updateFieldsAttributesDebounce),this.fields[e]=Pt({},this.fields[e],{},Ft),this.attributesUpdateRequired=!0,this.updateFieldsAttributesDebounce=setTimeout(this.doFieldsAttributeUpdate,100))}},{key:"dynamicFieldNoDataRender",value:function(e){if(this.fieldExists(e)){var t=this.fields[e];return!this.props.attributes[t.attributeKey]&&t.isActive&&t.source?React.createElement("span",{style:{color:"#ccc"}},Object(c.__)("This dynamic source returned no content.","wpv-views")):null}}},{key:"fieldExists",value:function(e){return"string"!=typeof e?(this.throwError("First parameter must be a string"),!1):!(!this.fields||!this.fields[e])||(this.throwError('The requested field "'.concat(e,'" is not registered.')),!1)}},{key:"getFieldControlSetup",value:function(e){var t=this,r=e.label||Object(c.__)("Dynamic Source","wpv-views");return{attributeKey:e.attributeKey,label:r,condition:e.condition||e.isActive,postProviderObject:e.provider,sourceObject:e.source,fieldObject:e.field,customPostObject:e.customPost,toggleHide:e.toggleHide||!1,toggleChangedCallback:function(){t.requestFieldToggle(e)},selectPostProviderChangedCallback:function(r){t.requestFieldAttributeUpdate(e,"provider",r),e.toggleHide&&t.requestFieldAttributeUpdate(e,"isActive",!0)},selectSourceChangedCallback:function(r){t.requestFieldAttributeUpdate(e,"source",r)},selectFieldChangedCallback:function(r){t.requestFieldAttributeUpdate(e,"field",r)},selectCustomPostChangedCallback:function(r){t.requestFieldAttributeUpdate(e,"customPost",r)},sourceContentFetchedCallback:function(r){t.updateFieldContent(e,r)},category:e.category||"text",bannedCategories:e.bannedCategories||[]}}},{key:"updateFieldContent",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t&&e.customContentCallback){if("function"==typeof e.customContentCallback)return e.customContentCallback(t),!1;this.throwError("customContentCallback must be a function.")}else{var n=t&&t.sourceContent?me(t.sourceContent):"";if(e.parse)switch(e.parse){case"int":n=parseInt(n);break;case"float":n=parseFloat(n)}if(r)return _t({},e.attributeKey,n);this.props.setAttributes(_t({},e.attributeKey,n))}}},{key:"requestFieldToggle",value:function(e){clearTimeout(this.updateFieldsAttributesDebounce),this.fields[e.attributeKey]=Pt({},this.fields[e.attributeKey],{},Ft),e.isActive||(this.fields[e.attributeKey].isActive=!0),this.attributesUpdateRequired=!0,this.updateFieldsAttributesDebounce=setTimeout(this.doFieldsAttributeUpdate,50)}},{key:"requestFieldAttributeUpdate",value:function(e,t,r){clearTimeout(this.updateFieldsAttributesDebounce),this.fields[e.attributeKey][t]&&this.fields[e.attributeKey][t]===r||(this.fields[e.attributeKey][t]=r,this.attributesUpdateRequired=!0),this.updateFieldsAttributesDebounce=setTimeout(this.doFieldsAttributeUpdate,120)}},{key:"doFieldsAttributeUpdate",value:function(){var e=this,t={};this.attributesUpdateRequired&&(this.attributesUpdateRequired=!1,Object.keys(this.fields).forEach(function(r){var n=function(e,t){if(void 0===t)return{};var r=Object(u.reduce)(e,function(e,r,n){return Object(u.isEqual)(r,t[n])?e:e.concat(n)},[]),n={};return r.forEach(function(e){n[e]=t[e]}),n}(Ft,e.fields[r]);Object.keys(n).length>0&&(t[r]=n)}),this.props.setAttributes(_t({},this.dynamicRootAttributeKey,t)))}},{key:"requestUpdateContent",value:function(){clearTimeout(this.updateContentDebounce),this.updateContentDebounce=setTimeout(this.doUpdateContent,500)}},{key:"doUpdateContent",value:function(){var e=this,t=this.currentPostId,r=this.props,c=r.setAttributes,i=r.clientId,a=window.toolsetDynamicSourcesScriptData,u=Object(o.applyFilters)("tb.dynamicSources.filters.adjustPreviewPostID",Object(n.select)(a.dynamicSourcesStore).getPreviewPost(),i)||t;Object.keys(this.fields).map(function(){var t,r=(t=regeneratorRuntime.mark(function t(r){var n,o,i,a,s,l,p,f,d;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.fields[r],o=n.isActive,i=n.source,a=n.field,s=n.provider,l=n.customPost,o&&i){t.next=3;break}return t.abrupt("return");case 3:return p=l?l.value:s,t.next=6,b(p,u,i,a||null);case 6:f=t.sent,!1!==(d=e.updateFieldContent(e.fields[r],f,!0))&&c(d);case 9:case"end":return t.stop()}},t)}),function(){var e=this,r=arguments;return new Promise(function(n,o){var c=t.apply(e,r);function i(e){St(c,n,o,i,a,"next",e)}function a(e){St(c,n,o,i,a,"throw",e)}i(void 0)})});return function(e){return r.apply(this,arguments)}}())}},{key:"throwError",value:function(e){console.error("[withToolsetDynamicField] ".concat(e))}},{key:"render",value:function(){return React.createElement(x.Fragment,null,React.createElement(Pe,this.props),React.createElement(e,Ot({},this.props,{dynamicFieldsRegister:this.dynamicFieldsRegister,dynamicFieldControlRender:this.dynamicFieldControlRender,dynamicFieldNoDataRender:this.dynamicFieldNoDataRender,dynamicFieldGet:this.dynamicFieldGet,dynamicFieldReset:this.dynamicFieldReset})))}}])&&Et(i.prototype,a),s&&Et(i,s),r}()},"withToolsetDynamicField");function It(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Tt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xt(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"current",i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{};if(e&&t){var u=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?It(r,!0).forEach(function(t){Tt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):It(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({provider:n,post:c,source:t},a),s="[tb-dynamic";return Object.keys(u).forEach(function(e){s+=" ".concat(e,"='").concat(u[e],"'")}),r&&(s+=" field='".concat(r,"'")),i&&(s+=" force-string='".concat(i,"' ")),s+="]"}return o}var Ut=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||!e.isActive||!e.source)return t;var n=r.post||"current",o=r.repeatableFieldShowOnly||!1,c=r.extraAttributes||{},i=e.customPost?e.customPost.value:e.provider;return xt(e.isActive,e.source,e.field,i,t,n,o,c)};r.d(t,"assureString",function(){return me}),r.d(t,"withPostPreview",function(){return Fe}),r.d(t,"fetchDynamicContent",function(){return b}),r.d(t,"fetchCache",function(){return y}),r.d(t,"searchPost",function(){return m}),r.d(t,"loadSourceFromCustomPost",function(){return h}),r.d(t,"SaveWrapper",function(){return Le}),r.d(t,"EditWrapper",function(){return Ze}),r.d(t,"EditOverlay",function(){return ct}),r.d(t,"DynamicSource",function(){return wt}),r.d(t,"withToolsetDynamicField",function(){return At}),r.d(t,"getShortcodeOrStatic",function(){return Ut});var Vt=window.WPViews;O(),T(),Vt&&(new ne,new ye)}]);